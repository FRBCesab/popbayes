<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fit a Bayesian model to estimate population size trend — fit_trend • popbayes</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Fit a Bayesian model to estimate population size trend — fit_trend" />
<meta property="og:description" content="This function applies a Bayesian model to count series in order to infer
the population trend over time. This function only works on the output of
format_data() or filter_series().
Important: This function uses R2jags::jags() and the
freeware JAGS (https://mcmc-jags.sourceforge.io/) must be
installed.
There are two types of options: model options (argument model_opts) and
MCMC options (argument mcmc_opts).
A. Model options
a smoothing factor: the precision (the inverse of variance) of a normal
distribution centered on the current relative rate of increase r from which
the next candidate relative rate of increase (see below) is drawn.
The highest this number, the tighter the link between successive relative
rates of increase. The default 100 corresponds to a moderate link.
a logical indicating whether the population growth must remain limited by
the species demographic potential (provided by the argument rmax in
format_data()).


The relative rate of increase is the change in log population size between
two dates. The quantity actually being modeled is the relative rate of
increase per unit of time (usually one date). This quantity reflects more
directly the prevailing conditions than the population size itself, which is
the reason why it has been chosen.
When the second model option is set to TRUE, the candidate rate of
increase is compared to the maximum relative rate of increase
(obtained when using format_data()) and replaced by rmax if greater.
B. MCMC options
Classical Markov chain Monte Carlo (MCMC) settings (see argument mcmc_opts
below)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">popbayes</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/popbayes.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/generate_data.html">Get species information</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/frbcesab/popbayes/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit a Bayesian model to estimate population size trend</h1>
    <small class="dont-index">Source: <a href='https://github.com/frbcesab/popbayes/blob/master/R/bugs-funs.R'><code>R/bugs-funs.R</code></a></small>
    <div class="hidden name"><code>fit_trend.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function applies a Bayesian model to count series in order to infer
the population trend over time. This function only works on the output of
<code><a href='format_data.html'>format_data()</a></code> or <code><a href='filter_series.html'>filter_series()</a></code>.</p>
<p><strong>Important:</strong> This function uses <code><a href='https://rdrr.io/pkg/R2jags/man/jags.html'>R2jags::jags()</a></code> and the
freeware <strong>JAGS</strong> (<a href='https://mcmc-jags.sourceforge.io/'>https://mcmc-jags.sourceforge.io/</a>) must be
installed.</p>
<p>There are two types of options: model options (argument <code>model_opts</code>) and
MCMC options (argument <code>mcmc_opts</code>).</p>
<p><strong>A. Model options</strong></p><ul>
<li><p>a smoothing factor: the precision (the inverse of variance) of a normal
distribution centered on the current relative rate of increase r from which
the next candidate relative rate of increase (see below) is drawn.
The highest this number, the tighter the link between successive relative
rates of increase. The default <code>100</code> corresponds to a moderate link.</p></li>
<li><p>a logical indicating whether the population growth must remain limited by
the species demographic potential (provided by the argument <code>rmax</code> in
<code><a href='format_data.html'>format_data()</a></code>).</p></li>
</ul>

<p>The relative rate of increase is the change in log population size between
two dates. The quantity actually being modeled is the relative rate of
increase per unit of time (usually one date). This quantity reflects more
directly the prevailing conditions than the population size itself, which is
the reason why it has been chosen.</p>
<p>When the second model option is set to <code>TRUE</code>, the candidate rate of
increase is compared to the maximum relative rate of increase
(obtained when using <code><a href='format_data.html'>format_data()</a></code>) and replaced by <code>rmax</code> if greater.</p>
<p><strong>B. MCMC options</strong></p>
<p>Classical Markov chain Monte Carlo (MCMC) settings (see argument <code>mcmc_opts</code>
below).</p>
    </div>

    <pre class="usage"><span class='fu'>fit_trend</span><span class='op'>(</span>
  <span class='va'>data</span>,
  model_opts <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fl'>100</span>, <span class='cn'>TRUE</span><span class='op'>)</span>,
  mcmc_opts <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>ni <span class='op'>=</span> <span class='fl'>50000</span>, nt <span class='op'>=</span> <span class='fl'>3</span>, nb <span class='op'>=</span> <span class='fl'>10000</span>, nc <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>,
  path <span class='op'>=</span> <span class='st'>"."</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>a named <code>list</code>. The output of <code><a href='format_data.html'>format_data()</a></code> or
<code><a href='filter_series.html'>filter_series()</a></code>.</p></td>
    </tr>
    <tr>
      <th>model_opts</th>
      <td><p>a <code>list</code> of two vectors. The model smoothing factor
(<code>numeric</code>) and a <code>logical</code> indicating if the parameter <strong>r</strong> must be
limited by <code>rmax</code> (<code>TRUE</code>) or not (<code>FALSE</code>). If this second parameter is
<code>TRUE</code>, the argument <code>rmax</code> cannot be <code>NULL</code> unless species are listed in
<code>popbayes</code> (in <code>species_info</code>).</p></td>
    </tr>
    <tr>
      <th>mcmc_opts</th>
      <td><p>a <code>list</code> containing the number of iterations (<code>ni</code>), the
thinning factor (<code>nt</code>), the length of burn in (<code>nb</code>), i.e. the number of
iterations to discard at the beginning, and the number of chains (<code>nc</code>).</p></td>
    </tr>
    <tr>
      <th>path</th>
      <td><p>a <code>character</code> string. The directory to save BUGS outputs (the
same as in <code><a href='format_data.html'>format_data()</a></code>).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An n-element <code>list</code> (where <code>n</code> is the number of count series). Each
element of the list is a BUGS output as provided by JAGS (also written
in the folder <code>path</code>).</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## Load Garamba raw dataset ----</span>
<span class='va'>file_path</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata"</span>, <span class='st'>"garamba_survey.csv"</span>, 
                         package <span class='op'>=</span> <span class='st'>"popbayes"</span><span class='op'>)</span>
                         
<span class='va'>garamba</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.csv</a></span><span class='op'>(</span>file <span class='op'>=</span> <span class='va'>file_path</span><span class='op'>)</span>

<span class='co'>## Create temporary folder ----</span>
<span class='va'>temp_path</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='co'>## Format dataset ----</span>
<span class='va'>garamba_formatted</span> <span class='op'>&lt;-</span> <span class='fu'>popbayes</span><span class='fu'>::</span><span class='fu'><a href='format_data.html'>format_data</a></span><span class='op'>(</span><span class='va'>garamba</span>, path <span class='op'>=</span> <span class='va'>temp_path</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'><span style='color: #00BB00;'>✔</span> Conversion data found in 'data'.</span></div><div class='output co'>#&gt; <span class='message'><span style='color: #00BB00;'>✔</span> Detecting <span style='color: #0000BB;'>10</span> count series</span></div><div class='input'>
<span class='co'>## Get data for Alcelaphus buselaphus at Garamba only ----</span>
<span class='va'>a_buselaphus</span> <span class='op'>&lt;-</span> <span class='fu'>popbayes</span><span class='fu'>::</span><span class='fu'><a href='filter_series.html'>filter_series</a></span><span class='op'>(</span><span class='va'>garamba_formatted</span>, 
                                        location <span class='op'>=</span> <span class='st'>"Garamba"</span>,
                                        species  <span class='op'>=</span> <span class='st'>"Alcelaphus buselaphus"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'><span style='color: #00BB00;'>✔</span> Found <span style='color: #0000BB;'>1</span> series with <span style='color: #0000BB;'>'Alcelaphus buselaphus'</span> and <span style='color: #0000BB;'>'Garamba'</span>.</span></div><div class='input'>                                        
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'>## Fit population trend (requires JAGS) ----</span>
<span class='va'>a_buselaphus_mod</span> <span class='op'>&lt;-</span> <span class='fu'>popbayes</span><span class='fu'>::</span><span class='fu'>fit_trend</span><span class='op'>(</span><span class='va'>a_buselaphus</span>, path <span class='op'>=</span> <span class='va'>temp_path</span><span class='op'>)</span>

<span class='co'>## Check for convergence ----</span>
<span class='fu'>popbayes</span><span class='fu'>::</span><span class='fu'><a href='diagnostic.html'>diagnostic</a></span><span class='op'>(</span><span class='va'>a_buselaphus_mod</span>, threshold <span class='op'>=</span> <span class='fl'>1.1</span><span class='op'>)</span>

<span class='co'>## Plot estimated population trend ----</span>
<span class='fu'>popbayes</span><span class='fu'>::</span><span class='fu'><a href='plot_trend.html'>plot_trend</a></span><span class='op'>(</span>series <span class='op'>=</span> <span class='st'>"garamba__alcelaphus_buselaphus"</span>, 
                     path   <span class='op'>=</span> <span class='va'>temp_path</span><span class='op'>)</span>

<span class='co'>## Plot MCMC traceplot ----</span>
<span class='fu'>R2jags</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/R2jags/man/traceplot.html'>traceplot</a></span><span class='op'>(</span><span class='va'>a_buselaphus_mod</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>, ask <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Nicolas Casajus, Roger Pradel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


