<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Format counts series — format_data • popbayes</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Format counts series — format_data" />
<meta property="og:description" content="This function provides an easy way to get counts series ready to
be analyzed by the package popbayes. It must be used prior to all other
functions.
This function formats the counts series (passed through the argument
data) by selecting and renaming columns, checking columns format and
content, and removing missing data (if na_rm = TRUE). It converts the
original data frame into a list of counts series that will be analyzed later
by the function fit_trend() to estimate population trends.
To be usable for the estimation of population trends, counts must be
accompanied by information on precision. The population trend model requires
a 95% confident interval (CI).
If estimates are total counts or guesstimates, this function will construct
boundaries of the 95% CI by applying the rules set out in ???.
If counts were estimated by a sampling method the user needs to specify a
measure of precision. Precision is preferably provided in the form of a 95%
CI by means of two fields: lower_ci and upper_ci. It may also be given
in the form of a standard deviation (sd), a variance (var), or a
coefficient of variation (cv). If the fields lower_ci and upper_ci are
both absent (or NA), fields sd, var, and cv are examined in this
order. When one is found valid (no missing value), a 95% CI is derived
assuming a normal distribution.
The field stat_method must be present in the data frame data to indicate
if counts are total counts ('T'), sampling ('S'), or
guesstimate ('G').
If a series mixes aerial and ground counts, a field field_method must
also be present and must contain either 'A' (aerial counts), or 'G'
(ground counts). As all counts must eventually refer to the same field method
for a correct estimation of trend, a conversion will be performed to
homogenize counts. This conversion is based on a preferred field method
and a conversion factor both specific to a species/category.
The preferred field method specifies the conversion direction. The conversion
factor is the multiplicative factor that must be applied to an aerial count
to get an equivalent ground count. (Note that if the preferred field method
is 'A', ground counts will be divided by the conversion factor to get the
equivalent aerial count.)
These two parameters, named pref_field_method and conversion_fact, can
be present in the data frame data or in the data frame info.
Alternatively, the package popbayes provides their values for some
African large mammals.
If the field field_method is absent in data, counts are assumed to be
obtained with one field method." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">popbayes</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/popbayes.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/generate_data.html">Get species information</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/frbcesab/popbayes/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Format counts series</h1>
    <small class="dont-index">Source: <a href='https://github.com/frbcesab/popbayes/blob/master/R/format-funs.R'><code>R/format-funs.R</code></a></small>
    <div class="hidden name"><code>format_data.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function provides an easy way to get counts series ready to
be analyzed by the package <code>popbayes</code>. It must be used prior to all other
functions.</p>
<p>This function formats the counts series (passed through the argument
<code>data</code>) by selecting and renaming columns, checking columns format and
content, and removing missing data (if <code>na_rm = TRUE</code>). It converts the
original data frame into a list of counts series that will be analyzed later
by the function <code><a href='fit_trend.html'>fit_trend()</a></code> to estimate population trends.</p>
<p>To be usable for the estimation of population trends, counts must be
accompanied by information on precision. The population trend model requires
a 95% confident interval (CI).
If estimates are total counts or guesstimates, this function will construct
boundaries of the 95% CI by applying the rules set out in <strong><em>???</em></strong>.
If counts were estimated by a sampling method the user needs to specify a
measure of precision. Precision is preferably provided in the form of a 95%
CI by means of two fields: <code>lower_ci</code> and <code>upper_ci</code>. It may also be given
in the form of a standard deviation (<code>sd</code>), a variance (<code>var</code>), or a
coefficient of variation (<code>cv</code>). If the fields <code>lower_ci</code> and <code>upper_ci</code> are
both absent (or <code>NA</code>), fields <code>sd</code>, <code>var</code>, and <code>cv</code> are examined in this
order. When one is found valid (no missing value), a 95% CI is derived
assuming a normal distribution.
The field <code>stat_method</code> must be present in the data frame <code>data</code> to indicate
if counts are <strong>total counts</strong> (<code>'T'</code>), <strong>sampling</strong> (<code>'S'</code>), or
<strong>guesstimate</strong> (<code>'G'</code>).</p>
<p>If a series mixes aerial and ground counts, a field <code>field_method</code> must
also be present and must contain either <code>'A'</code> (aerial counts), or <code>'G'</code>
(ground counts). As all counts must eventually refer to the same field method
for a correct estimation of trend, a conversion will be performed to
homogenize counts. This conversion is based on a <strong>preferred field method</strong>
and a <strong>conversion factor</strong> both specific to a species/category.
The preferred field method specifies the conversion direction. The conversion
factor is the multiplicative factor that must be applied to an aerial count
to get an equivalent ground count. (Note that if the preferred field method
is <code>'A'</code>, ground counts will be divided by the conversion factor to get the
equivalent aerial count.)
These two parameters, named <code>pref_field_method</code> and <code>conversion_fact</code>, can
be present in the data frame <code>data</code> or in the data frame <code>info</code>.
Alternatively, the package <code>popbayes</code> provides their values for some
African large mammals.
If the field <code>field_method</code> is absent in data, counts are assumed to be
obtained with one field method.</p>
    </div>

    <pre class="usage"><span class='fu'>format_data</span><span class='op'>(</span>
  <span class='va'>data</span>,
  info <span class='op'>=</span> <span class='cn'>NULL</span>,
  year <span class='op'>=</span> <span class='st'>"year"</span>,
  counts <span class='op'>=</span> <span class='st'>"counts"</span>,
  location <span class='op'>=</span> <span class='st'>"location"</span>,
  species <span class='op'>=</span> <span class='st'>"species"</span>,
  stat_method <span class='op'>=</span> <span class='st'>"stat_method"</span>,
  lower_ci <span class='op'>=</span> <span class='st'>"lower_ci"</span>,
  upper_ci <span class='op'>=</span> <span class='st'>"upper_ci"</span>,
  sd <span class='op'>=</span> <span class='cn'>NULL</span>,
  var <span class='op'>=</span> <span class='cn'>NULL</span>,
  cv <span class='op'>=</span> <span class='cn'>NULL</span>,
  field_method <span class='op'>=</span> <span class='st'>"field_method"</span>,
  pref_field_method <span class='op'>=</span> <span class='cn'>NULL</span>,
  conversion_fact <span class='op'>=</span> <span class='cn'>NULL</span>,
  path <span class='op'>=</span> <span class='st'>"."</span>,
  na_rm <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>a data frame with at least five columns: <code>location</code>, <code>species</code>,
<code>year</code>, <code>counts</code>, and <code>stat_method</code>.</p>
<p>The <code>stat_method</code> field indicates the method used to estimate counts. It
can contain: <code>T</code> (total counts), <code>G</code> (guesstimate), and/or <code>S</code> (sampling).</p>
<p>If individual counts were estimated by <strong>sampling</strong>, additional column(s)
providing a measure of precision is also required (e.g. <code>lower_ci</code> and
<code>upper_ci</code>, or <code>sd</code>, <code>cv</code>, <code>var</code>). Precision metrics can be different
between counts. For instance, some sampling counts can have a <code>sd</code> value
and others <code>lower_ci</code> and <code>upper_ci</code>. In that case three columns are
required (<code>lower_ci</code>, <code>upper_ci</code>, and <code>sd</code>). See above section
<strong>Description</strong> for further information on the computation of the 95%
confident interval of estimates.</p>
<p>If the individuals were counted by different methods, an additional field
<code>field_method</code> is also required. It can contain: <code>G</code> (ground counts)
and/or <code>A</code> (aerial counts). See above section <strong>Description</strong> for further
information on the counts conversion.</p>
<p>Others fields can be present either in <code>data</code> or <code>info</code> (see below).</p></td>
    </tr>
    <tr>
      <th>info</th>
      <td><p>(optional) a data frame with species in rows and the following
columns: <code>species</code> (species name), <code>pref_field_method</code>,and
<code>conversion_fact</code>. See above section <strong>Description</strong> for further
information on these fields.
Default is <code>NULL</code> (i.e. these information must be present in <code>data</code>
if not available in <code>popbayes</code>).</p></td>
    </tr>
    <tr>
      <th>year</th>
      <td><p>a character string. The column name in <code>data</code> of the year.
This column <code>year</code> must be in the form 1999, 2000, etc. (numeric), with
possibly a decimal part.
Default is <code>'year'</code>.</p></td>
    </tr>
    <tr>
      <th>counts</th>
      <td><p>a character string. The column name in <code>data</code> of the
number of individuals. This column must be numerical.
Default is <code>'counts'</code>.</p></td>
    </tr>
    <tr>
      <th>location</th>
      <td><p>a character string. The column name in <code>data</code> of the
site. This field is used to distinguish counts series from different sites
(if required) and to create an unique series name.
Default is <code>'location'</code>.</p></td>
    </tr>
    <tr>
      <th>species</th>
      <td><p>a character string. The column name in <code>data</code> (and
in <code>info</code> if provided) of the species. This field is used to distinguish
counts series for different species (if required) and to create an unique
series name.
Default is <code>'species'</code>.</p></td>
    </tr>
    <tr>
      <th>stat_method</th>
      <td><p>a character string. The column name in <code>data</code> of
the method used to estimate individuals counts. It can contain <code>'T'</code>
(total counts), <code>'G'</code> (guesstimate), and/or <code>'S'</code> (sampling). If some
counts are coded as <code>'S'</code>, precision column(s) must also be provided (see
below).
Default is <code>'stat_method'</code>.</p></td>
    </tr>
    <tr>
      <th>lower_ci</th>
      <td><p>(optional) a character string. The column name in <code>data</code>
of the lower boundary of the 95% CI of the estimate (i.e. <code>counts</code>). If
provided, the upper boundary of the 95% CI (argument <code>upper_ci</code>) must be
also provided. This argument is only required if some counts have been
estimated by a sampling method. But user may prefer use other precision
measures, e.g. standard deviation (argument <code>sd</code>), variance (argument
<code>var</code>), or coefficient of variation (argument <code>cv</code>).
Default is <code>'lower_ci'</code>.</p></td>
    </tr>
    <tr>
      <th>upper_ci</th>
      <td><p>(optional) a character string. The column name in <code>data</code>
of the upper boundary of the 95% CI of the estimate (i.e. <code>counts</code>). If
provided, the lower boundary of the 95% CI (argument <code>lower_ci</code>) must be
also provided.
Default is <code>'upper_ci'</code>.</p></td>
    </tr>
    <tr>
      <th>sd</th>
      <td><p>(optional) a character string. The column name in <code>data</code> of
the standard deviation of the estimate.
Default is <code>NULL</code>.</p></td>
    </tr>
    <tr>
      <th>var</th>
      <td><p>(optional) a character string. The column name in <code>data</code> of
the variance of the estimate.
Default is <code>NULL</code>.</p></td>
    </tr>
    <tr>
      <th>cv</th>
      <td><p>(optional) a character string. The column name in <code>data</code> of
the coefficient of variation of the estimate.
Default is <code>NULL</code>.</p></td>
    </tr>
    <tr>
      <th>field_method</th>
      <td><p>(optional) a character string. The column name in
<code>data</code> of the field method used to count individuals. Counts can be ground
counts (coded as <code>'G'</code>) or aerial counts (coded as <code>'A'</code>). This argument
is optional if individuals have been counted by the same method. See above
section <strong>Description</strong> for further information on the counts conversion.
Default is <code>'field_method'</code>.</p></td>
    </tr>
    <tr>
      <th>pref_field_method</th>
      <td><p>(optional) a character string. The column name
in <code>data</code> of the preferred field method of the species. This argument is
only required is <code>field_method</code> is not NULL (i.e. individuals have been
counted by different methods). Alternatively, this value can be passed in
<code>info</code>(or internally retrieved if the species is listed in the package).
See above section <strong>Description</strong> for further information on the counts
conversion.
Default is <code>NULL</code>.</p></td>
    </tr>
    <tr>
      <th>conversion_fact</th>
      <td><p>(optional) a character string. The column name
in <code>data</code> of the counts conversion factor of the species. This argument is
only required if <code>field_method</code> is not NULL (i.e. individuals have been
counted by different methods). Alternatively this value can be passed in
<code>info</code> (or internally retrieved if the species is listed in the package).
See above section <strong>Description</strong> for further information on the counts
conversion.
Default is <code>NULL</code>.</p></td>
    </tr>
    <tr>
      <th>path</th>
      <td><p>a character string. The directory to save formatted data.
This directory must exist and can be an absolute or a relative path.</p></td>
    </tr>
    <tr>
      <th>na_rm</th>
      <td><p>a logical. If <code>TRUE</code>, counts with <code>NA</code> values will be removed.
Default is <code>FALSE</code> (returns an error to inform user if <code>NA</code> are detected).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An n-elements list (where n is the number of counts series). The name
of each element of this list is a combination of location and species.
Each element of the list is a list with the following content:</p><ul>
<li><p><code>location</code> a character string. The name of the series site.</p></li>
<li><p><code>species</code> a character string. The name of the series species.</p></li>
<li><p><code>years</code> a numerical vector. The sequence of years of the series.</p></li>
<li><p><code>n_years</code> an integer. The number of unique years.</p></li>
<li><p><code>stat_methods</code> a character vector. The different stat methods
of the series.</p></li>
<li><p><code>field_methods</code> (optional) a character vector. The different
field methods of the series.</p></li>
<li><p><code>pref_field_method</code> (optional) a character. The preferred
field method of the species (<code>'A'</code> or <code>'G'</code>).</p></li>
<li><p><code>conversion_fact</code> (optional) a numeric. The conversion factor
of the species used to convert counts to its preferred field method.</p></li>
<li><p><code>data_original</code> a data frame. Original data of the series with
renamed columns. Some rows may have been deleted (if <code>na_rm = TRUE</code>).</p></li>
<li><p><code>data_converted</code> a data frame. Data containing computed
boundaries of the 95% CI (<code>lower_ci_conv</code> and <code>upper_ci_conv</code>). If
counts have been obtained by different field methods, contains also
converted counts (<code>counts_conv</code>) based on the preferred field method and
conversion factor of the species. This data frame will be used by the
function <code><a href='fit_trend.html'>fit_trend()</a></code> to fit population models.</p></li>
</ul>

<p><strong>Note:</strong> Some original series can be discarded if one of these two
conditions is met: 1) the series contains only zero counts, and 2) the
series contains only a few years (&lt; 4 years).</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='st'>"garamba"</span><span class='op'>)</span>

<span class='co'>## Format dataset ----</span>
<span class='va'>garamba_formatted</span> <span class='op'>&lt;-</span> <span class='fu'>popbayes</span><span class='fu'>::</span><span class='fu'>format_data</span><span class='op'>(</span><span class='va'>garamba</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>garamba_formatted</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>garamba_formatted</span><span class='op'>)</span>

<span class='co'>## Retrieve counts series names ----</span>
<span class='fu'>popbayes</span><span class='fu'>::</span><span class='fu'><a href='list_series.html'>list_series</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Nicolas Casajus, Roger Pradel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


